#!/bin/bash
# Run Codex with super agent settings (auto-approve mode)
#
# Codex reads instructions from ~/.codex/AGENTS.md
# For super mode, we swap the symlink to include superagents.md content

AGENTS_MD="/workspace/.agentbox/agents.md"
SUPER_MD="/workspace/.agentbox/superagents.md"
COMBINED="/tmp/agentbox-super-instructions.md"
CODEX_AGENTS="${HOME}/.codex/AGENTS.md"

# Create combined instructions file
if [[ -f "${AGENTS_MD}" ]] && [[ -f "${SUPER_MD}" ]]; then
    cat "${AGENTS_MD}" "${SUPER_MD}" > "${COMBINED}"
    # Update symlink to point to combined file
    ln -sf "${COMBINED}" "${CODEX_AGENTS}"
fi

# Export env var so MCP can also detect super mode
export AGENTBOX_SUPER_MODE=true

exec codex \
    --dangerously-bypass-approvals-and-sandbox \
    -c 'notify=["/usr/local/bin/notify", "Codex", "Task completed"]' \
    "$@"
